Bootstrap: docker
from: ubuntu:20.04

%environment
    JULIA_PKGDIR="/opt/.julia"
    JULIA_DEPOT_PATH="/opt/.julia"

    export JULIA_PKGDIR
    export JULIA_DEPOT_PATH

%post
    export JULIA_VER_MAJORMINOR=1.4
    export JULIA_VER=1.4.2
    export JULIA_TARBALL=julia-$JULIA_VER-linux-x86_64.tar.gz

    apt-get update
    apt-get install -y \
        ca-certificates \
        wget \
        hdf5-tools \
        locales \
        libopenblas-dev \

    update-ca-certificates

    # install julia
    wget https://julialang-s3.julialang.org/bin/linux/x64/$JULIA_VER_MAJORMINOR/$JULIA_TARBALL
    tar -xvzf $JULIA_TARBALL --no-same-permissions
    mv /julia-$JULIA_VER /opt/
    ln -s /opt/julia-$JULIA_VER/bin/julia /usr/local/bin/julia

    # create some necessary folders
    mkdir ~/.julia

    # clean up
    rm $JULIA_TARBALL

    # setup packages
    julia -e 'using Pkg; Pkg.init()'

%runscript
    julia test.jl
